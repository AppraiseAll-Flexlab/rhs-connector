var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _DBConnect=require("./DBConnect");var socket=require("socket.io");var socketConfigure=function socketConfigure(server,dbConnect){var io=socket(server);io.on("connection",function(socket){socket.on("connect",function(){});socket.on("disconnect",function(){var socketId=socket.id;dbConnect((0,_DBConnect.invoke)("_removeSubscribe",{socketId:socketId}));});var socketInvoke=function socketInvoke(info){var id=info.id,paramValue=info.paramValue;if(!id){throw new Error("id is mandatory in socket call");}return dbConnect((0,_DBConnect.invoke)(id,paramValue));};socket.on("subscribe",function(info){try{var socketId=socket.id;dbConnect((0,_DBConnect.invoke)("_subscribe",_extends({socketId:socketId},info,{callback:function callback(event){socket.emit("onServerUpdate",event);}})));}catch(err){console.log("error at server in save view",err.stack);}});socket.on("removeSubscribe",function(info){try{var socketId=socket.id;dbConnect((0,_DBConnect.invoke)("_removeSubscribe",_extends({socketId:socketId},info)));}catch(err){console.log("error at server in save view",err.stack);}});socket.on("invoke",function(info,callback){try{socketInvoke(info).then(function(result){return callback(null,result);}).catch(function(err){return callback(err.stack);});}catch(err){console.log("error at server in save view",err.stack);callback(err.stack);}});});};var info={id:"createLead",paramValue:{updates:{_id:"53a44bf7faba6a0200b65227"}}};module.exports={socketConfigure:socketConfigure};