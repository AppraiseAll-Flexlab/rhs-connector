Object.defineProperty(exports,"__esModule",{value:true});exports.addAttachmentIfRequired=undefined;var _this=this;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _DBConnect=require("./DBConnect");var addAttachmentIfRequired=exports.addAttachmentIfRequired=function addAttachmentIfRequired(options,args){var _dbConnect,filesInfo,attachments,_iterator,_isArray,_i,_ref,fileInfo,fileData;return regeneratorRuntime.async(function addAttachmentIfRequired$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!args||!options)){_context.next=2;break;}return _context.abrupt("return");case 2:_dbConnect=args._dbConnect;filesInfo=options.attachments;if(!filesInfo){_context.next=34;break;}if(!Array.isArray(filesInfo)){filesInfo=[filesInfo];}attachments=[];_iterator=filesInfo,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?typeof Symbol==="function"?Symbol.iterator:"@@iterator":"@@iterator"]();case 8:if(!_isArray){_context.next=14;break;}if(!(_i>=_iterator.length)){_context.next=11;break;}return _context.abrupt("break",33);case 11:_ref=_iterator[_i++];_context.next=18;break;case 14:_i=_iterator.next();if(!_i.done){_context.next=17;break;}return _context.abrupt("break",33);case 17:_ref=_i.value;case 18:fileInfo=_ref;if(!fileInfo.key){_context.next=26;break;}_context.next=22;return regeneratorRuntime.awrap(_dbConnect((0,_DBConnect.invoke)("_downloadFile",fileInfo.key)));case 22:fileData=_context.sent;attachments.push({filename:fileData.fileName,contentType:fileData.contentType,content:new Buffer(fileData.data,"utf-8")});_context.next=31;break;case 26:if(!fileInfo.content){_context.next=30;break;}attachments.push(_extends({},fileInfo,{content:new Buffer(fileInfo.content,"utf-8")}));_context.next=31;break;case 30:throw new Error("Either key or content should defined in files to send attachment in mail.");case 31:_context.next=8;break;case 33:options.attachments=attachments;case 34:case"end":return _context.stop();}}},null,_this);};